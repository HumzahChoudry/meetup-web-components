sudo: false
language: node_js
node_js:
- 7.7.1
cache:
  yarn: true
  directories:
  - node_modules
branches:
  only:
  - master
env:
  global:
  - CI_BUILD_NUMBER=$TRAVIS_BUILD_NUMBER
  - secure: DTA/wJ8Z0AMMnCtzokJoAeFWC45FrJNZJIx+2V7esCqdNMTg3vNbbcCdthm2qw/Lgu8SbstzBqGiaaHwvTUoy3y4Kk38T+Fx8uGbfbl7NMN/f/TaxiSJuEHaBgz0ot29EfjIljnxaTLBZY9ADOr8j+jLnJMwBybKzmZcRuRXFE02+Zqvj/UhIBW46KurjMWzcySvIre4wZAIpsff7X9tHpK4y0/1dyo6QEpn/WAuDBB5ueBypZvQvsKRM+PwWR9YuByxHfPtVdAE2sUUFnVFJofWwFrOOtz1fQ8Vp259gEBEXEAVzSifMcItXudXNCcM8Hy4H9IrrNd8gkztSm8pssvjkLhsinTbb+UeGxVEHOQUojAcFHFAThiNGEV1GV7sY1fEBoujgRtlUQJaCBsW4boAwNElsJq3tKJ5Vj/FSaiE58uKjS2FItrvAKiNTe9TUPGTxEiFfbKDH6wmEiYXB33Ra3aoYv68ZEBpLdLHKMIBXoC+QgGsQEEPj8PC8gkBQ7josTJD8UkPQA8L29WUkyPw/TcWb4F6myiUqms2wKfwtuGobDV867dUQy2WxT3h4N5uNRNeirR8mXJdbGdzTg0KgJm1FNKjmewae/n97B+604eQgz4NLqI2pOaaZm5nqqqG3ItzuURuNNBZmL8xGH4VIGH6xJu+6frdDxhssNk=
before_install:
- openssl aes-256-cbc -K $encrypted_9064aff2eda1_key -iv $encrypted_9064aff2eda1_iv
  -in '.travis/github_deploy_key.enc' -out github_deploy_key -d
- echo "//registry.npmjs.org/:_authToken=\${NPM_TOKEN}" > .npmrc
before_script:
- git diff --exit-code yarn.lock
after_script:
- git config --global user.email "builds@travis-ci.com"
- git config --global user.name "Travis CI"
- $(yarn bin)/set-up-ssh --key "$encrypted_9064aff2eda1_key" --iv "$encrypted_9064aff2eda1_iv"
  --path-encrypted-key ".travis/github_deploy_key.enc"
- '[ "${TRAVIS_BRANCH}" = "master" ] && [ "${TRAVIS_PULL_REQUEST}" = "false" ] &&
  export GIT_TAG=$(make version) || export GIT_TAG=$(make version)-beta

'
- '[ "${TRAVIS_BRANCH}" = "master" ] && [ "${TRAVIS_PULL_REQUEST}" = "false" ] &&
  export NPM_TAG=latest || export NPM_TAG=beta

'
- echo "GIT_TAG=$GIT_TAG"
- echo "NPM_TAG=$NPM_TAG"
- '[ "${TRAVIS_BRANCH}" != "master" ] && echo "skipping versioning" || yarn run build
  && npm version $GIT_TAG -m "Version $GIT_TAG built by Travis CI - https://travis-ci.com/$TRAVIS_REPO_SLUG/builds/$TRAVIS_JOB_ID"
  && git push --tags git@github.com:$TRAVIS_REPO_SLUG.git && npm publish --tag $NPM_TAG

'
after_success:
- npm run coveralls

notifications:
  slack:
    secure: X6mGHvTBJMCEYuWU8qjU4jVI1d+bmrErbmHrB9Bvi7wcGsJX1OzguvcnIx+3+WaB04e3p6dmnty082xyYVYOkADQbR9UVAGEKKwlxv20C5EaKRg4iSkg1HmAMDux5pn/BX9ZXpZ2PhWt0JoAJvBC0JVTA7U+6u2AZYjiBgxcX0en0P66EM0xpemjpwsHGsT99VSf0hIGQXUS2lkW7tGVZoXH2iYq4Kv19baHvjg56VTiay+tpUnZ1lW7yQtmQ/16QTigLySrigyKO6ROCS666TGmblrDb2CcfnQaGQpSq0K5u49miqy5NxDR5d56SaWW1h8Pw6rS5AW5WIUvjnl0BSsH+EkYSCzqENmJu+CkZJijwLiDPDLovulH9C59pvq2qFN7D3HbseqO7soIfzZ6zOa2/a1WdxwfgcA5JnSu61AcAe5mDXGL+d2CKxut8t9wYWMTn5Nyp22UeVOs0DxImo6h6wG3S5wWdLMXVbs2WX8DpL+6HEf39EACrikl33si3E2HRzrzRng1Q//GWWiBbet5otO5jqNZv/SgYEXopnqlJAz8pdftdV7aNshubiCpO7XM6+DNTVlXkyCd9motB6fLbjJwRIGRY21M5sVTyN82mgS8V+bkt4PxpOtL04ZW8is59XnwG2jiSqLmd9C1qo5cwlCTVD+7hJaPeif8KMw=
